---
phase: 09-admin-features
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - pages/admin/ActivityLogs.tsx
autonomous: true

must_haves:
  truths:
    - "Activity log fetches real data from activities API"
    - "No filtering UI — simple scrollable list"
    - "Toggle between all activity and my activity views"
    - "Pagination via Load More button"
    - "Each entry shows context with navigation links"
  artifacts:
    - path: "pages/admin/ActivityLogs.tsx"
      provides: "Activity log page with real data, toggle, and load more"
      min_lines: 100
  key_links:
    - from: "pages/admin/ActivityLogs.tsx"
      to: "/api/activities"
      via: "fetch with credentials and query params"
      pattern: "fetch.*activities"
---

<objective>
Rewrite the ActivityLogs page to fetch real data from the activities API, replacing all mock data and removing the filtering UI per user decisions.

Purpose: The current ActivityLogs.tsx uses MOCK_PROJECTS, returns empty arrays, and has extensive filtering UI (search, project filter, action type filter, date range). User explicitly decided: "No filtering UI — simple scrollable list with sidebar scrollbar." This rewrite implements the user's vision: a clean activity stream with all/my toggle and Load More pagination.

Output: Rewritten ActivityLogs.tsx with real API data, context links, toggle, and load more.
</objective>

<execution_context>
@/Users/praburajasekaran/.claude/get-shit-done/workflows/execute-plan.md
@/Users/praburajasekaran/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-admin-features/09-CONTEXT.md
@.planning/phases/09-admin-features/09-RESEARCH.md
@.planning/phases/09-admin-features/09-01-SUMMARY.md

@pages/admin/ActivityLogs.tsx
@services/activityApi.ts
@contexts/AuthContext.tsx
@lib/api-config.ts
@components/ui/ErrorState.tsx
@components/ui/EmptyState.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite ActivityLogs with real API data</name>
  <files>pages/admin/ActivityLogs.tsx</files>
  <action>
    Completely rewrite `pages/admin/ActivityLogs.tsx`. Remove ALL mock data, filtering UI, and CSV export.

    **Structure:**
    1. **Header:** "Activity Logs" title + subtitle
    2. **Toggle bar:** "All Activity" / "My Activity" toggle buttons (pill-style, like segmented control)
    3. **Activity list:** Simple scrollable list of activity entries (not a table — more like a feed/stream)
    4. **Load More button:** At bottom, loads next page of activities

    **Data fetching:**
    - Fetch from activities API: `/.netlify/functions/activities?limit=50` for "all" mode
    - For "my" mode: `/.netlify/functions/activities?userId=${currentUser.id}&limit=50`
    - Admin role check: only super_admin and project_manager can access (keep existing access denied UI)
    - Track `offset` state for pagination — increment by 50 on Load More
    - On Load More, append to existing activities (don't replace)
    - Track `hasMore` state — hide Load More when fewer results returned than limit
    - Use `credentials: 'include'` on all fetches

    **Activity entry format (each entry in the list):**
    Each entry is a card-like row showing:
    ```
    [User avatar initial] [User Name] [action description]
    [Relative time] · [Context link: project/proposal name]
    ```

    - User avatar: circular initial badge (like existing ActivityLogs pattern)
    - Action description: human-readable label derived from activity type
      - PROPOSAL_SENT -> "sent a proposal"
      - PROPOSAL_ACCEPTED -> "accepted a proposal"
      - PROPOSAL_REJECTED -> "rejected a proposal"
      - PROPOSAL_CHANGES_REQUESTED -> "requested changes on a proposal"
      - DELIVERABLE_APPROVED -> "approved a deliverable"
      - DELIVERABLE_REJECTED -> "rejected a deliverable"
      - PAYMENT_RECEIVED -> "received a payment"
      - COMMENT_ADDED -> "added a comment"
      - PROJECT_CREATED -> "created a project"
      - TASK_CREATED -> "created a task"
      - TASK_STATUS_CHANGED -> "updated task status"
      - FILE_UPLOADED -> "uploaded a file"
      - TEAM_MEMBER_INVITED -> "invited a team member"
      - Default: humanize the type string (replace _ with space, lowercase)
    - Context link: If projectName is present, link to `/projects/${projectId}`. If proposalId is present, link to `/admin/proposals/${proposalId}`. If inquiryId and no project, link to `/admin/inquiries/${inquiryId}`.
    - Relative time: "just now", "X min ago", "X hours ago", "yesterday", or formatted date

    **Activity type badges:**
    - Small colored badge next to the action (like existing getActivityTypeBadgeColor pattern)
    - Group by category:
      - Proposals: purple
      - Payments: green
      - Deliverables: blue
      - Tasks: cyan
      - Files: indigo
      - Team: orange
      - Comments: emerald

    **Toggle behavior:**
    - "All Activity" shows all platform activities (no userId filter)
    - "My Activity" filters by current user's ID
    - Switching toggle resets the list and offset, fetches fresh

    **Load More:**
    - Button at bottom: "Load More" with loading spinner while fetching
    - Pass offset query param to API
    - Append results to existing list
    - When results.length < 50, set hasMore=false and hide button
    - Show "No more activities" text when hasMore is false and activities exist

    **States:**
    - Loading: Skeleton loader (3-4 placeholder rows)
    - Error: ErrorState component with retry
    - Empty: EmptyState component with appropriate message
    - No more: "You've seen all activities" text

    **Remove completely:**
    - All filter states (projectFilter, actionTypeFilter, searchQuery, startDate, endDate)
    - Filter UI section (the grid with inputs/selects)
    - MOCK_PROJECTS reference
    - CSV export functionality
    - The `<table>` element — replace with a vertical feed/stream layout
    - Import of `ActivityType` and `Project` from portal types (use string type for activity types)
    - The `AggregatedActivity` interface
    - All `useMemo` filter logic

    **Styling:**
    - Consistent with admin portal (Tailwind, rounded corners, shadows)
    - Lucide React icons (Activity, Users, etc.)
    - Clean vertical stream layout with hover states
    - Each entry: `bg-white rounded-lg p-4 hover:bg-gray-50 transition-colors`
  </action>
  <verify>
    1. `npm run build` passes
    2. No MOCK_PROJECTS references remain
    3. No filter UI elements (search, selects, date inputs)
    4. Toggle between "All Activity" and "My Activity" works
    5. "Load More" button present at bottom
    6. Activity entries include navigation links
  </verify>
  <done>
    Activity log shows real data from API in a clean stream layout.
    Toggle switches between all/my views. Load More appends next page.
    Each entry shows user, action, context link, and relative time.
    No filtering UI, no CSV export, no mock data.
  </done>
</task>

</tasks>

<verification>
1. ActivityLogs.tsx fetches from activities API with real data
2. No filtering UI (per user decision)
3. All/My toggle works with userId filter
4. Load More pagination appends results
5. Navigation links to projects/proposals present
6. Build passes
</verification>

<success_criteria>
- Activity log shows real activities from database
- All/My toggle switches view correctly
- Load More appends next batch of 50 activities
- Each entry has context link to relevant project/proposal
- No filtering UI, no mock data, no CSV export
</success_criteria>

<output>
After completion, create `.planning/phases/09-admin-features/09-03-SUMMARY.md`
</output>

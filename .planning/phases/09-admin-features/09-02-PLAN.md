---
phase: 09-admin-features
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - pages/Dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard displays accurate metrics from real database data"
    - "Metric cards are interactive — clicking expands inline to show breakdown"
    - "Recent activity table shows latest platform actions with context links"
    - "Dashboard feels functional and data-dense, not decorative"
  artifacts:
    - path: "pages/Dashboard.tsx"
      provides: "Admin dashboard with real metrics and recent activity"
      min_lines: 150
  key_links:
    - from: "pages/Dashboard.tsx"
      to: "/api/dashboard-metrics"
      via: "fetch with credentials"
      pattern: "fetch.*dashboard-metrics"
    - from: "pages/Dashboard.tsx"
      to: "/api/activities"
      via: "fetch for recent activity table"
      pattern: "fetch.*activities"
---

<objective>
Rewrite the admin Dashboard page to display real platform metrics from the dashboard-metrics API and recent activity from the activities API.

Purpose: The current Dashboard.tsx uses hardcoded mock data and Recharts visualizations. Per user decisions: no charts/visualizations, numbers and tables only, interactive metric cards that expand inline, data-dense functional feel.

Output: Fully rewritten Dashboard.tsx with metric cards (expandable), recent activity table with navigation links.
</objective>

<execution_context>
@/Users/praburajasekaran/.claude/get-shit-done/workflows/execute-plan.md
@/Users/praburajasekaran/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-admin-features/09-CONTEXT.md
@.planning/phases/09-admin-features/09-RESEARCH.md
@.planning/phases/09-admin-features/09-01-SUMMARY.md

@pages/Dashboard.tsx
@pages/admin/InquiryDashboard.tsx
@pages/admin/Payments.tsx
@services/activityApi.ts
@contexts/AuthContext.tsx
@lib/api-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Dashboard with real metrics and interactive cards</name>
  <files>pages/Dashboard.tsx</files>
  <action>
    Completely rewrite `pages/Dashboard.tsx`. Remove ALL Recharts imports and mock data.

    **Structure:**
    1. **Header row:** "Dashboard" title + subtitle showing user's name + role
    2. **Metric cards grid (4 columns on lg, 2 on md, 1 on sm):**
       - "Total Projects" (FolderOpen icon, blue) — click expands to show active/completed breakdown
       - "Proposals" (FileText icon, purple) — click expands to show pending/accepted/total
       - "Revenue" (DollarSign icon, green) — click expands to show completed/pending amounts
       - "Inquiries" (MessageSquare icon, amber) — click expands to show new/total
    3. **Recent Activity table:** Fetched from activities API (limit=10, no context filters = admin global)
       - Columns: Time (relative), User, Action, Context (project/proposal link)
       - Each row links to relevant entity via React Router Link
       - Shows loading skeleton while fetching
       - If no activities, show EmptyState component

    **Data fetching:**
    - Use `useEffect` to fetch from `/api/dashboard-metrics` with `credentials: 'include'`
    - Use `useEffect` to fetch from `/api/activities?limit=10` with `credentials: 'include'`
    - Show loading state while both are fetching
    - Use ErrorState component on fetch failure with retry

    **Interactive metric cards:**
    - Track `expandedCard` state (string | null)
    - Clicking a card toggles expansion
    - Expanded section shows breakdown as a simple list:
      ```
      Active: 5
      Completed: 12
      Total: 17
      ```
    - Use ChevronDown/ChevronUp icon to indicate expandability

    **Activity type display:**
    - Map activity types to human-readable labels:
      - PROPOSAL_SENT -> "Sent proposal"
      - PROPOSAL_ACCEPTED -> "Proposal accepted"
      - PAYMENT_RECEIVED -> "Payment received"
      - DELIVERABLE_APPROVED -> "Deliverable approved"
      - COMMENT_ADDED -> "Comment added"
      - PROJECT_CREATED -> "Project created"
      - etc.
    - Map types to Lucide icons (Send, CheckCircle, CreditCard, Package, MessageSquare, FolderPlus)

    **Relative time formatting:**
    - Use a simple helper: "just now" (<1 min), "X minutes ago" (<60), "X hours ago" (<24), "yesterday", or date string
    - No external library needed

    **Styling:**
    - Use Tailwind classes consistent with InquiryDashboard.tsx and Payments.tsx
    - Lucide React icons (per CLAUDE.md)
    - No charts, no visualizations — numbers and tables only
    - Remove Recharts from imports entirely

    **Important constraints:**
    - Remove ALL Recharts imports (BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid, AreaChart, Area)
    - Remove hardcoded `data` array
    - Keep the existing export pattern (`export const Dashboard`)
    - Use ErrorState from components/ui/ErrorState and EmptyState from components/ui/EmptyState
  </action>
  <verify>
    1. `npm run build` passes
    2. No Recharts imports remain in Dashboard.tsx
    3. Dashboard fetches from /api/dashboard-metrics and /api/activities
    4. Metric cards have onClick expand behavior
    5. Recent activity table renders with navigation links
  </verify>
  <done>
    Dashboard displays real platform metrics in expandable cards and recent activity table with context links.
    No charts or visualizations. Functional, data-dense layout.
  </done>
</task>

</tasks>

<verification>
1. Dashboard.tsx has zero Recharts references
2. Metrics fetch from dashboard-metrics endpoint
3. Activity table fetches from activities endpoint
4. Card click expands inline breakdown
5. Build passes
</verification>

<success_criteria>
- Dashboard shows real metrics from database (not mock data)
- Metric cards expand on click to show breakdown
- Recent activity table shows latest actions with links to projects/proposals
- No charts, no hardcoded data, no Recharts
</success_criteria>

<output>
After completion, create `.planning/phases/09-admin-features/09-02-SUMMARY.md`
</output>
